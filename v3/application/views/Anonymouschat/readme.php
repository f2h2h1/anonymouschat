<h2>说明</h2>
<pre>
0. 需要有一定的技术水平，才能看懂
1. 需要一个已经认证了的服务号
2. 公众号需要绑定微信开放平台（因为需要获取 unionid ）
3. 会占用 access token
4. 会占用文字消息，语音消息以及关注事件
5. 5分钟未成功匹配会自动退出
6. 聊天时长为 5 分钟到 10 分钟，在这个区间内可以自行设置时长
7. 需要提供公众号的原始 id
8. 需要把服务器的 ip 在公众号的后台设为白名单（因为要获取 access token ）
9. 使用的是客服接口转发消息，客服接口一天的上限是五十万条
10. 当聊天人数足够多时，时间限制不会很准确，大概表现为，限制 10 分的聊天时间，可能会有 11 分钟或 12 分钟
11. 设置允许聊天的时间段时，不要跨日期，例如，晚上 10 点到凌晨 2 点这种，这个跨日期的问题作者还没有处理好
12. 占用了 access token 后，绝大部分第三方平台的功能都会用不到的（除了关键字回复这类简单的，因为占用了 access token ，大部分微信接口都会失效），所以实际的应用场景往往这个公众号只有匿名聊天这一个应用
13. 保留字有四个， 交友 1 2 exit ，分别用于触发聊天模式，选择性别，退出聊天模式
14. 有一个敏感词列表，用户聊天中发送敏感词会被替换为 * 号，敏感词大都和 政治 相关，一般聊天很少遇到的，这个列表也是从百度上找的。
15. 那个分享的统计也不是很准确的，在人数足够多的情况下，服务器响应慢一点，微信就会重复发送关注事件，这时同一个分享就有会多次计数
</pre>

<h2>如何接入</h2>
<pre>
0. 这套代码是从微校拓展的基础上修改而来的，所以接入的公众号最好也使用微校，其实用微擎，微动力之类的也可以的。
1. 选择接入方式，可以通过第三方平台接入或直接在公众号的后台设置服务器地址
2. 如果直接在公众号的后台设置服务器地址，就在填这个 url <?=$base_url?>/callbak.php ，token 填 weixinweixin，然后会有四个关键字， 交友 1 2 exit ，分别用于触发聊天模式，选择性别，退出聊天模式，关键字都不可以修改
3. 如果通过第三方平台接入，则需要设置一条文本消息转发，文本消息全转发，语音消息全转发，关注事件全转发。“文本消息转发，文本消息全转发，语音消息全转发，关注事件全转发”，这是在微校后台的设置，其他第三方平台不一定是这么称呼这些设置。
4. 一条文本消息转发，设置的是进入聊天模式的关键字，这条文本消息转发的规则必须是最优先的，url 为 <?=site_url('Anonymouschatapi/joinchat')?> ，token 填 weixinweixin
5. 文本消息全转发和语音消息全转发， url 为 <?=site_url('Anonymouschatapi/joinchat')?> ，token 填 weixinweixin
6. 关注事件全转发， url 为 <?=site_url('Anonymouschatapi/subscribe')?> ，token 填 weixinweixin
</pre>

<div style="visibility:hidden" id="ps">ps: 受作者水平限制，代码实现并不优雅，不少地方都是大力出奇迹的。</div>
<script>
    console.log(document.getElementById("ps").innerHTML);
</script>
